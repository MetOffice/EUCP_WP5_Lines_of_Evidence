# ESMValTool
# Recipe to calc temporal statistics of models
# adapted from example python recipe
---
documentation:
  description: |
    Recipe to calculate temporal statistics of supplied datasets

  # Need to setup author and project entries
  authors:
  - andela_bouwe
  - righi_mattia

  #maintainer:
  #  - crocker_thomas

  #projects:
  #  - EUCP_WP5

dataset_groups:
  # CMIP5
  CMIP5_base: &CMIP5_based
  - {dataset: CNRM-CM5, project: CMIP5, ensemble: r1i1p1, mip: Amon}
  - {dataset: HadGEM2-ES, project: CMIP5, ensemble: r1i1p1, mip: Amon}
  - {dataset: MPI-ESM-LR, project: CMIP5, ensemble: r1i1p1, mip: Amon}
  # EURO CORDEX (EUR-11) (only MOHC RCM ones..)
  # need to run with '--check level relaxed' to avoid error about lat and lon coord names
  - {institute: MOHC, driver: CNRM-CERFACS-CNRM-CM5, dataset: MOHC-HadREM3-GA7-05, project: CORDEX, ensemble: r1i1p1, mip: mon, rcm_version: v2, domain: EUR-11}
  - {institute: MOHC, driver: MOHC-HadGEM2-ES, dataset: MOHC-HadREM3-GA7-05, project: CORDEX, ensemble: r1i1p1, mip: mon, rcm_version: v1, domain: EUR-11}
  - {institute: MOHC, driver: MPI-M-MPI-ESM-LR, dataset: MOHC-HadREM3-GA7-05, project: CORDEX, ensemble: r1i1p1, mip: mon, rcm_version: v1, domain: EUR-11}

  CMIP6: &CMIP6
  # CMIP6 more complex, need to specify Activity (CMIP or ScenarioMIP) and then experiment (historical, or SSP585 etc.)
  - {dataset: CanESM5, project: CMIP6, ensemble: r1i1p1f1, grid: gn, mip: Amon}
  - {dataset: HadGEM3-GC31-LL, project: CMIP6, ensemble: r1i1p1f3, grid: gn, mip: Amon}
  - {dataset: MPI-ESM1-2-LR, project: CMIP6, ensemble: r1i1p1f1, grid: gn, mip: Amon}


preprocessors:
  mean:
    climate_statistics:
      operator: mean
      period: month


var_def:
  var: &var
    # Change short name to process a different variable
    # change preprocessor to calc a different stat
    short_name: pr
    preprocessor: mean

  var_hist: &var_hist
    <<: *var
    exp: historical
    additional_datasets: *CMIP5_based

  var_rcp85: &var_rcp85
    <<: *var
    exp: rcp85
    additional_datasets: *CMIP5_based

  var_hist_CMIP6: &var_hist_CMIP6
    <<: *var
    activity: CMIP
    exp: historical
    additional_datasets: *CMIP6

  var_SSP585: &var_SSP585
    <<: *var
    exp: ssp585
    additional_datasets: *CMIP6


diagnostics:
  stats:
    description: Compute stats
    variables:
      # historical period
      var_1960s:
        <<: *var_hist
        start_year: 1961
        end_year: 1970

      var_1970s:
        <<: *var_hist
        start_year: 1971
        end_year: 1980

      var_1980s:
        <<: *var_hist
        start_year: 1981
        end_year: 1990

      var_1990s:
        <<: *var_hist
        start_year: 1991
        end_year: 2000

      # future RCP85
      var_2040s_rcp85:
        <<: *var_rcp85
        start_year: 2041
        end_year: 2050

      var_2050s_rcp85:
        <<: *var_rcp85
        start_year: 2051
        end_year: 2060
    
      var_2060s_rcp85:
        <<: *var_rcp85
        start_year: 2061
        end_year: 2070

      var_2070s_rcp85:
        <<: *var_rcp85
        start_year: 2071
        end_year: 2080

      var_2080s_rcp85:
        <<: *var_rcp85
        start_year: 2081
        end_year: 2090

      # note 2100 missing here as not available in some CORDEX output..
      var_2090s_rcp85:
        <<: *var_rcp85
        start_year: 2091
        end_year: 2099

      # Now for CMIP6 variables
      # historical period
      var_1960s_CMIP6:
        <<: *var_hist_CMIP6
        start_year: 1961
        end_year: 1970

      var_1970s_CMIP6:
        <<: *var_hist_CMIP6
        start_year: 1971
        end_year: 1980

      var_1980s_CMIP6:
        <<: *var_hist_CMIP6
        start_year: 1981
        end_year: 1990

      var_1990s_CMIP6:
        <<: *var_hist_CMIP6
        start_year: 1991
        end_year: 2000

      # Future period
      var_2040s_SSP585:
        <<: *var_SSP585
        start_year: 2041
        end_year: 2050

      var_2050s_SSP585:
        <<: *var_SSP585
        start_year: 2051
        end_year: 2060
    
      var_2060s_SSP585:
        <<: *var_SSP585
        start_year: 2061
        end_year: 2070

      var_2070s_SSP585:
        <<: *var_SSP585
        start_year: 2071
        end_year: 2080

      var_2080s_SSP585:
        <<: *var_SSP585
        start_year: 2081
        end_year: 2090

      # note 2100 missing here as not available in some CORDEX output..
      var_2090s_SSP585:
        <<: *var_SSP585
        start_year: 2091
        end_year: 2099

    scripts:
      main:
        script: /home/users/tcrocker/code/EUCP_WP5_Lines_of_Evidence/esmvaltool/diagnostics/print_diag.py